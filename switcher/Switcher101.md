# 易动导播的前生与今世

最初的易动导播台只是个练手作品，它简陋低效，仅仅能够使用局域网以一个私有协议去串流 4 个 480p 的画面，没有其他任何功能。它只是一个雏型，一个设想。试问，如果有一天，一台仅仅[ 174 克的 iPhone ](https://www.apple.com/cn/iphone/compare/)或者[ 469 克的 iPad ](https://www.apple.com/cn/ipad/compare/)就能完成原来需要一个笨拙的台式机才能完成的工作，你愿意抛开那些线缆的羁绊吗？

## 网络与设备的飞速发展

去年开始，各种无限流量套餐开始兴起，价格也降低到让你不觉得肉疼的水平；5G 的声音也越来越响亮了，正式的商用产品的大规模上架可能也就 2019 年的事情。固定宽带方面，民用的宽带上下行带宽进一步放大，以杭州为例，100M 的民用宽带价格早已不足 1 元每天，上行带宽也大多能够超过 20M（不同机房的网速差异明显，比如我上行到苹果服务器机房的网速能达到 100M 上限）。在不久的未来，可以预见的是：**上下行的带宽与网络延迟会越来越满足移动直播的场景需求**。

在移动芯片界，苹果的 A 系列芯片一直是怪物一般的存在，更不用说 iPad Pro 专属的 A_X 系列了。还记得 H.264/AVC 刚刚兴起的时候，硬编解码 H.264 可并不是每台电脑都能够流畅执行的。对应的 Intel 平台大约是酷睿 3 代 ( 2012 年) 能够完整的使用内置 GPU 进行编解码 (1080p)。但是由于桌面平台对于功耗并不敏感，所以大部分情况下，你使用软解码就够了，即使风扇轰鸣也只是在机箱里。然而移动平台却具有天生的功耗敏感性，能够使用 GPU 解码的，绝不考虑使用 CPU 去软解。毕竟不仅是烫手的山芋的问题，在高温下，内置电池不仅不耐用，也更不安全。

苹果的 A4 - A7 (2010 - 2013 年) 就已经具有硬编解码能力，只是水平不同。A4 到 A6 的 iOS 设备是支持 H.264/AVC/MPEG-4 Part 10 (until profile 100 and up to level 5.1)，MPEG-4 Part 2 和 H.263 的。A7 加入了对 H.264’s Profile 110 的支持，它允许各个颜色通道从 8 位编码增加到 10 位，这使更高级别的色彩细节成为可能 (这个功能通常用于电视台或者媒体编辑行业)。到了 A8 这一代 (2014 年)，正式开放了硬编解码相关的接口，其实也意味着相关技术的成熟。A9 这一代 (2015 年) 硬编解码能力达到了 4K@30 的分辨率。A10 这代（2016 年）开始具有硬解 H.265/HEVC 的能力，不过相关接口是 2017 年的 iOS 11 / macOS 10.13 中才开放的。A11 这代（2017 年）最终获得了完整的硬编解码 4K@60 分辨率的 H.265/HEVC 的能力。今年会有什么？我记得去年的 WWDC17 有提到分层编码技术 (HEVC)，同一路 240fps 的原始视频，同时转码输出 30fps/60fps/120fps。外加苹果自研的 GPU 技术，今年有很大可能带来 4K@120 的分辨率。

## 导播需要多少硬件算力

一般意义上，我们会 **需要 4 个输入源，1 个预监画面，1 个播出画面** 。对此我们至少就需要 4 路解码能力，4 路简单渲染能力（输入源预览），2 路重绘渲染（1 个预监画面 + 1 个播出画面 预览），以及 1 路编码能力（ 输出上传 ）。

这个模型还是太复杂，还是不好分析。由于视频占用算力的大头，那我们就先忽略音频部分。我们假设 **输出分辨率为 1080p@30**，硬编码解码的算力大致相等。那么大约需要 6 个 1080p@30 的算力，加上别的开销，**A9 已经无法达到这个要求，A10 比较吃力，A11 则比较轻松** 。但是如果退一步到 720p@30 ，那么 A9 就也能够胜任。由于 A8 与 A9 间存在代差，如果 A8 设备也想要有 4 + 1 + 1 个画面，则分辨率要进一步下降到 480p，基本失去意义。

## 观众需要多少清晰度

影响清晰度有两个控制因素，分辨率与码率。同一分辨率下，码率越高则感官上更加清晰。但是有时光提升分辨率却不提升码率的行为会带来适得其反的效果。甚至有时候高分辨率低码率下带来很差的观看体验（比如某鱼曾有一段时间的 1080p@30 仅用 2000 Kbps 的码率）。

YouTube 的推荐码率如下表：

|  分辨率   |       码率     |
|----------|----------------|
|  480p@30 |  500-2000 Kbps |
|  720p@30 | 1500-4000 Kbps |
|  720p@60 | 2250-6000 Kbps |
| 1080p@30 | 3000-6000 Kbps |
| 1080p@60 | 4500-9000 Kbps |

播出内容也很影响导播的效果，如果是桌面游戏的录屏内容，那么 1080p 基本是必须的，不然胡的连文字都看不清；如果是手机游戏的录屏内容，按照原始分辨率的来总不会有错；但如果是拍摄的内容，比如美女主播跳个舞，那么高码率的 720p 其实也可以了。

## 易动导播 2 的设计标准

新做的东西历史包袱越小越好。由于文件管理，录屏，HEVC 都是 iOS 才有的功能，所以编译目标就是 iOS 11 起。

大部分情况下，易动导播应该要能够支持 1080p@30 的输出基准，那么至少需要 A10 的设备去满足。如果手头只有 A9，那么只能降格为 2+1+1 即仅 2 画面组合切换，如果需要更多的画面切换，则需要关闭暂时不用的画面或者降低分辨率。

实际上，导播的过程也就是 ** 输入 -> 编辑 -> 输出 ** 的过程。

### 对于输入部分

设计上希望能有接口去**播放在线源**，例如 RTMP 拉流、HTTP 内容的在线播放；能有接口去**播放本地源**，例如事前做好的视频文件、相册内的视频文件；能够**作为 RTMP Server 去接收**局域网内编码器或是另一个易动导播 2 / 易动拍摄 2 所发出的视频流。

### 对于编辑部分

添加背景、前景图片是必不可少的；场景的转换也需要提供专门的通道；若是自定义文字控件、转场也能够支持那就太完美了。

### 对于输出部分

现在大部分是通过 RTMP 协议去进行发布，这是必不可少的。如果本地网络条件允许，肯定有人希望能有多路推流的能力。对了本地录像也不能少。

以上便是 易动导播 2 所要达到的主要功能，如果你想为我们改进产品出谋划策，那么请来[参加我们的第一次内测吧](/common/TestFlight101.html)。

---

** 附件： iOS 11 设备支持表 **

| 评级 |      型号      |   年代  | 芯片  | 运行内存 | 状态 |
|-----|----------------|--------|------|---------|-----|
| 完美 | iPad Pro 12.9 第二代 | 2017.6 | A10X | 4G | 在售 |
| 完美 | iPad Pro 10.5  | 2017.6 | A10X | 4G | 在售 |
| 最佳 | iPhone X       | 2017.9 | A11  | 3G | 在售 |
| 最佳 | iPhone 8 Plus  | 2017.9 | A11  | 3G | 在售 |
| 最佳 | iPhone 8       | 2017.9 | A11  | 2G | 在售 |
| 基准 | iPad Pro 9.7   | 2016.3 | A9X  | 4G | 停产 |
| 基准 | iPad Pro 12.9 第一代 | 2015.9 | A9X  | 4G | 停产 |
| 基准 | iPad 第六代     | 2018.3 | A10  | 2G | 在售 |
| 基准 | iPhone 7 Plus  | 2016.9 | A10  | 3G | 在售 |
| 基准 | iPhone 7       | 2016.9 | A10  | 2G | 在售 |
| 入门 | iPad 第五代     | 2017.3 | A9   | 2G | 停产 |
| 入门 | iPad Air 2     | 2014.9 | A8X  | 2G | 停产 |
| 入门 | iPhone 6s Plus | 2015.9 | A9   | 2G | 在售 |
| 入门 | iPhone 6s      | 2015.9 | A9   | 2G | 在售 |
| 入门 | iPhone SE      | 2016.3 | A9   | 2G | 在售 |

***注：对于易动导播 2 而言，以上排名分先后。对于表外的其他 iOS 11 设备，内存仅为 1G，会在 480p@30 状态下受限运行，严重不推荐***

***注2：由于 iOS 10.2 以后的电源管理对于电池严重老化的设备，限制了整体的性能，以应对意外关机。而我们所有的性能计算都是在不降频的情况下得出的，如果你已经升级到 iOS 11.3 或者更新版本，可以在电池选项中查看。***